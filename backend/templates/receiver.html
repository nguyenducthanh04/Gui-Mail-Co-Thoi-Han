<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ng∆∞·ªùi nh·∫≠n</title>
  <style>
    body {
      text-align: center;
      font-family: Arial;
      margin-top: 40px;
    }

    button {
      width: 200px;
      height: 40px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }

    #notice {
      margin-top: 20px;
      font-weight: bold;
      color: red;
    }

    #res {
      margin-top: 20px;
      font-weight: bold;
      color: green;
    }

    #dl {
      display: none;
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h2>üì• Nh·∫≠n tin nh·∫Øn v√† gi·∫£i m√£</h2>
  <button onclick="receive()">Nh·∫≠n</button>

  <div id="notice"></div>
  <div id="res"></div>

 <script>
  function receive() {
    fetch("/receive", { method: "POST" })
      .then(r => r.json())
      .then(j => {
        const resDiv = document.getElementById("res");
        resDiv.innerText = j.message;

        // N·∫øu nh·∫≠n th√†nh c√¥ng th√¨ hi·ªán th√¥ng b√°o x√°c nh·∫≠n
        if (j.message.includes("‚úÖ")) {
          document.getElementById("dl").style.display = "inline";
          document.getElementById("notice").innerText = "‚úÖ ƒê√£ nh·∫≠n g√≥i tin th√†nh c√¥ng!";
          document.getElementById("notice").style.color = "green";
        }
      });
  }

  function checkPacketStatus() {
    fetch("/check_packet")
      .then(res => res.json())
      .then(data => {
        const notice = document.getElementById("notice");
        const resDiv = document.getElementById("res");

        if (data.has_packet) {
          const mins = Math.floor(data.remaining / 60);
          const secs = data.remaining % 60;
          notice.innerText = `üì© C√≥ g√≥i tin m·ªõi! Vui l√≤ng nh·∫≠n tr∆∞·ªõc khi h·∫øt h·∫°n (${mins} ph√∫t ${secs} gi√¢y).`;
          notice.style.color = "red";

          // N·∫øu tr∆∞·ªõc ƒë√≥ hi·ªÉn th·ªã 'ch∆∞a c√≥ g√≥i tin', th√¨ x√≥a ƒëi
          if (resDiv.innerText.includes("Ch∆∞a c√≥ g√≥i tin")) {
            resDiv.innerText = "";
          }

        } else {
          notice.innerText = "";
          resDiv.innerHTML = "‚ùó <span style='color: green;'>Ch∆∞a c√≥ g√≥i tin n√†o ƒë∆∞·ª£c g·ª≠i!</span>";
        }
      });
  }

  // Ki·ªÉm tra tr·∫°ng th√°i m·ªói 3 gi√¢y
  setInterval(checkPacketStatus, 3000);
</script>

</body>
</html>
